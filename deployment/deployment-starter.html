<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Deployment - Starter | FoundationaLLM </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Deployment - Starter | FoundationaLLM ">
      
      
      <link rel="icon" href="../media/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/solliancenet/foundationallm/blob/main/docs/deployment/deployment-starter.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../media/fllm-icon.svg" alt="FoundationaLLM">
            FoundationaLLM
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="deployment---starter">Deployment - Starter</h1>

<p>Foundationa<strong>LLM</strong> deploys into your own Azure Subscription. By default it will deploy to Azure Container Apps (ACA) that make it fast to get started. When you want to deploy to production at scale, you can also deploy to Azure Kubernetes Service (AKS). Given that there are Azure Subscription quota limits to the number of Azure OpenAI Service resources you can deploy, you can choose to use an existing Azure OpenAI Service resource instead of a creating a new one with your deployment.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Azure Subscription (Subscription needs to be whitelisted for Azure OpenAI).</li>
<li>Subscription access to Azure OpenAI service. Start here to <a href="https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso_Pz4b1_xUNTZBNzRKNlVQSFhZMU9aV09EVzYxWFdORCQlQCN0PWcu">Request Access to Azure OpenAI Service</a>.</li>
<li><a href="https://dotnet.microsoft.com/download/dotnet/8.0">.NET 8 SDK</a>.</li>
<li>Docker Desktop.</li>
<li>Azure CLI (<a href="https://docs.microsoft.com/cli/azure/install-azure-cli">v2.51.0 or greater</a>).</li>
<li>Azure Developer CLI (<a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/install-azd">v1.6.1 or greater</a>)</li>
<li>Powershell 7 (<a href="https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-windows?view=powershell-7.4">7.4.1 or greater</a>)
<blockquote>
<p>Note: Powershell 7 is required for <code>pwsh</code> to work in the AZD hooks as an alias to <code>powershell</code></p>
</blockquote>
</li>
<li>Visual Studio 2022 (only needed if you plan to run/debug the solution locally).</li>
<li>Minimum quota of 65 CPUs across all VM family types. Start here to <a href="https://learn.microsoft.com/azure/quotas/per-vm-quota-requests">Manage VM Quotas</a>.</li>
<li>Four App Registrations created in the Entra ID tenant (Azure Active Directory). Follow the instructions in the <a href="authentication/index.html">Authentication setup document</a> to configure authentication for the solution.
<ul>
<li>Chat Client App Registration</li>
<li>Core API App Registration</li>
<li>Management Client App Registration</li>
<li>Management API App Registration</li>
</ul>
</li>
<li>User with the following role assignments:
<ul>
<li>Owner on the target subscription;</li>
<li>Owner on the two app registrations.</li>
</ul>
</li>
</ul>
<h2 id="deployment-steps">Deployment steps</h2>
<p>Follow the steps below to deploy the solution to your Azure subscription. You will be prompted to log in to your Azure account during the deployment process.</p>
<ol>
<li><p>Ensure all the prerequisites are met, and that Docker Desktop is running.</p>
</li>
<li><p>From a PowerShell prompt, execute the following to clone the repository:</p>
<pre><code class="lang-cmd">git clone https://github.com/solliancenet/foundationallm.git
git checkout release/0.4.0
</code></pre>
</li>
<li><p>Open a PowerShell instance and run the following script to provision the infrastructure and deploy the API and frontend. This will provision all of the required infrastructure, deploy the API and web app services, and import data into Cosmos DB.</p>
<p>Run the following command to set the appropriate application registration settings for OIDC authentication. Please refer to the instructions in the <a href="authentication/index.html">Authentication setup document</a> to configure authentication for the solution and obtain the appropriate client Ids, scopes, and tenant Ids for the following steps.</p>
<pre><code class="lang-pwsh">cd foundationallm
cd deploy/starter

az login            # Log into Azure CLI
azd auth login      # Log into Azure Developer CLI

azd env             # Set your target Subscription and Location

azd env set ENTRA_CHAT_UI_CLIENT_ID &lt;Chat UI Client Id&gt;
azd env set ENTRA_CHAT_UI_SCOPES &lt;Chat UI Scope&gt;
azd env set ENTRA_CHAT_UI_TENANT_ID &lt;Chat UI Tenant ID&gt;

azd env set ENTRA_CORE_API_CLIENT_ID &lt;Core API Client Id&gt;
azd env set ENTRA_CORE_API_SCOPES &lt;Core API Scope&gt;
azd env set ENTRA_CORE_API_TENANT_ID &lt;Core API Tenant ID&gt;

azd env set ENTRA_MANAGEMENT_API_CLIENT_ID &lt;Management API Client Id&gt;
azd env set ENTRA_MANAGEMENT_API_SCOPES &lt;Management API Scope&gt;
azd env set ENTRA_MANAGEMENT_API_TENANT_ID &lt;Management API Tenant ID&gt;

azd env set ENTRA_MANAGEMENT_UI_CLIENT_ID &lt;Management UI Client Id&gt;
azd env set ENTRA_MANAGEMENT_UI_SCOPES &lt;Management UI Scope&gt;
azd env set ENTRA_MANAGEMENT_UI_TENANT_ID &lt;Management UI Tenant ID&gt;

azd env set ENTRA_VECTORIZATION_API_CLIENT_ID &lt;Vectorization API Client Id&gt;
azd env set ENTRA_VECTORIZATION_API_SCOPES &lt;Vectorization API Scope&gt;
azd env set ENTRA_VECTORIZATION_API_TENANT_ID &lt;Vectorization API Tenant ID&gt;
</code></pre>
<p>After setting the OIDC specific settings in the AZD environment above, run <code>azd up</code> in the same folder location to build the docker images, provision the infrastructure, update the configuration, deploy the API and web app services into container app instances, and import files into the storage account.</p>
<pre><code class="lang-pwsh">azd up
</code></pre>
</li>
</ol>
<h3 id="authentication-setup">Authentication setup</h3>
<p>Follow the instructions in the <a href="authentication/index.html">Authentication setup document</a> to configure authentication for the solution.</p>
<h2 id="update-apis-and-portals-from-local-code-changes">Update APIs and portals from local code changes</h2>
<p>To update APIs and portals from local code changes, run the following from the <code>./deploy/starter</code> folder in your locally cloned repository:</p>
<pre><code class="lang-pwsh">azd deploy
</code></pre>
<h2 id="update-individual-apis-or-portals">Update individual APIs or portals</h2>
<h3 id="update-individual-apis-or-portals-with-images-from-the-public-container-repositorywhen-using-microsoft-azure-container-apps-aca">Update individual APIs or portals with images from the public container repositorywhen using Microsoft Azure Container Apps (ACA)</h3>
<p>To update an individual API or portal, you can use the following commands:</p>
<ol>
<li><p>Login with your Entra ID account:</p>
<pre><code class="lang-pwsh">az login
</code></pre>
</li>
<li><p>Set the target subscription:</p>
<pre><code class="lang-pwsh">az account set --subscription &lt;target_subscription_id&gt;
</code></pre>
</li>
<li><p>Navigate to the FoundationaLLM GitHub Container Registry and obtain the SHA or image tag of the container you would like to update.</p>
<p><img src="media/latest-image-release.png" alt="Latest release of the image on the GitHub Container Registry." title="Verifying Latest Image Release"></p>
</li>
<li><p>Use the following Azure CLI command to update the desired container. <code>--image</code> is a fully-qualified name (e.g., <code>ghcr.io/solliancenet/foundationallm/agent-factory-api:latest</code>).</p>
<pre><code class="lang-pwsh">az containerapp update --name &lt;aca_name&gt; --resource-group &lt;resource_group_name&gt; --image &lt;image_name&gt;
</code></pre>
<p>The following table indicates the mapping between each component of FLLM and the relevant Azure Container Apps instance (<code>--name</code>).</p>
<table>
<thead>
<tr>
<th>API</th>
<th>Container Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Core API</td>
<td><code>cacoreapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Agent Factory API</td>
<td><code>caagentfactoryapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Agent Hub API</td>
<td><code>caagenthubapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Chat UI</td>
<td><code>cachatui[SUFFIX]</code></td>
</tr>
<tr>
<td>Core Job API</td>
<td><code>cacorejob[SUFFIX]</code></td>
</tr>
<tr>
<td>Data Source Hub API</td>
<td><code>caadatasourcehubapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Gatekeeper API</td>
<td><code>cagatekeeperapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Gatekeeper Integration API</td>
<td><code>cagatekeeperintegrationapi[SUFFIX]</code></td>
</tr>
<tr>
<td>LangChain</td>
<td><code>calangchainapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Management API</td>
<td><code>camanagementapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Management UI</td>
<td><code>camanagementui[SUFFIX]</code></td>
</tr>
<tr>
<td>Prompt Hub API</td>
<td><code>caprompthubapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Semantic Kernel API</td>
<td><code>casemantickernelapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Vectorization API</td>
<td><code>camanagementapi[SUFFIX]</code></td>
</tr>
<tr>
<td>Vectorization Worker</td>
<td><code>camanagementjob[SUFFIX]</code></td>
</tr>
</tbody>
</table>
</li>
</ol>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/solliancenet/foundationallm/blob/main/docs/deployment/deployment-starter.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © FoundationaLLM. All rights reserved. | Find out more about FoundationaLLM at <a href="https://foundationallm.ai">foundationallm.ai</a>.
        </div>
      </div>
    </footer>
  </body>
</html>
